webpackJsonp([8],{"/pee":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("Xxa5"),i=a.n(s),r=a("exGp"),n=a.n(r),o=a("bOdI"),c=a.n(o),u=(a("NC6I"),a("Fd2+")),p={props:{id:0},data:function(){var e;return e={price:0,VIP_price:99,res:{},index:1,show:!1,showloading:!0,timer:null,ispay:0,form:"",pop_show:!1,uuid:""},c()(e,"timer",null),c()(e,"paying",!1),c()(e,"finished",!1),e},beforeCreate:function(){var e=this;return n()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("micromessenger"!=navigator.userAgent.toLowerCase().match(/MicroMessenger/i)){t.next=15;break}if(!(a=localStorage.getItem("token"))){t.next=10;break}return t.next=6,e.$http.get("auth/check/token/"+a);case 6:t.sent.data.result_state||(localStorage.setItem("url",location.href),"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?e.$router.push("/wlogin"):e.$router.push("/login")),t.next=13;break;case 10:localStorage.setItem("url",location.href),"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?e.$router.push("/wlogin"):e.$router.push("/login");case 13:t.next=16;break;case 15:return t.abrupt("return");case 16:case"end":return t.stop()}},t,e)}))()},computed:{level:function(){return 1*localStorage.getItem("level")},platform_id:function(){return this.getUrlParam("platform_id")},isweixin:function(){return"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)}},created:function(){var e=this;return n()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.$route.query.payback&&(e.uuid=e.$route.query.uuid,e.id=e.$route.query.id,e.$dialog.alert({message:"支付成功"}).then(function(){e.$router.push({name:"test",params:{id:e.id,mid:e.uuid}})}));case 2:case"end":return t.stop()}},t,e)}))()},methods:{back:function(){window.history.length<=1?this.$router.push({name:"main"}):this.$router.go(-1)},getUrlParam:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(t);return null!=a?unescape(a[2]):null},pay_success:function(e){var t=this;this.$dialog.alert({message:"支付成功"}).then(function(){t.$router.push({name:"test",params:{id:t.id,mid:e}})})},vip_pay_free:function(){var e=this;return n()(i.a.mark(function t(){var a,s;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.post("order/test_question/paid_user/save",{platform_id:e.platform_id,ref_ids:[e.id]});case 2:if(200!=(a=t.sent).code){t.next=8;break}return t.next=6,e.$http.get("order/test_question/question",{params:{uuid:a.data.uuid}});case 6:200==(s=t.sent).code&&e.$router.push({name:"test",params:{id:e.id,mid:s.data.order_question_list[0].member_test_question_id}});case 8:case"end":return t.stop()}},t,e)}))()},pay_free:function(){var e=this;return n()(i.a.mark(function t(){var a,s;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.post("order/test_question/free/save",{platform_id:e.platform_id,ref_ids:[e.id]});case 2:if(200!=(a=t.sent).code){t.next=8;break}return t.next=6,e.$http.get("order/test_question/question",{params:{uuid:a.data.uuid}});case 6:200==(s=t.sent).code&&e.$router.push({name:"test",params:{id:e.id,mid:s.data.order_question_list[0].member_test_question_id}});case 8:case"end":return t.stop()}},t,e)}))()},ali_pay:function(){var e=this;return n()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.pop_show=!0,e.show=!1,t.next=4,e.$http.post("pay/alipay/wappay",{number:1,package_key:"num_1",package_type:1,platform_id:e.platform_id,ref_ids:[e.id],total_fee:1});case 4:200==(a=t.sent).code&&(e.uuid=a.data.uuid,e.form=a.data.form,e.$nextTick(function(e){document.querySelector("input[type=submit]").click()})),e.check_pay(),console.log(a.data);case 8:case"end":return t.stop()}},t,e)}))()},h5_pay:function(){var e=this;return n()(i.a.mark(function t(){var a,s,r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.post("pay/wxpay/h5_url",{number:1,package_key:"num_1",package_type:1,platform_id:e.platform_id,ref_ids:[e.id],total_fee:1});case 2:200==(a=t.sent).code&&(a.data,e.uuid=a.data.uuid,s=location.href+"?uuid="+e.uuid+"&id="+e.id+"&payback=1",r=a.data.url+"&redirect_url="+encodeURIComponent(s),window.location.replace(r));case 4:case"end":return t.stop()}},t,e)}))()},weixin_pay:function(){var e=this;return n()(i.a.mark(function t(){var a,s;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.is_weixn()){t.next=10;break}return t.next=3,e.$http.post("pay/wxpay/jsapi_prepay",{number:1,package_key:"num_1",package_type:1,platform_id:e.platform_id,ref_ids:[e.id],total_fee:1});case 3:a=t.sent,s=a.data,e.uuid=a.data.uuid,WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:s.app_id,timeStamp:s.time_stamp,nonceStr:s.nonce_str,package:s.packages,signType:s.sign_type,paySign:s.pay_sign},function(e){e.err_msg}),e.check_pay(),t.next=11;break;case 10:e.h5_pay();case 11:console.log(res);case 12:case"end":return t.stop()}},t,e)}))()},check_pay:function(){var e=this;return n()(i.a.mark(function t(){var a,s;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("order/status/"+e.uuid);case 2:if(200!=(a=t.sent).code){t.next=12;break}if(1!=a.data.status){t.next=11;break}return t.next=7,e.$http.get("order/test_question/question",{params:{uuid:e.uuid}});case 7:200==(s=t.sent).code&&e.pay_success(s.data.order_question_list[0].member_test_question_id),t.next=12;break;case 11:setTimeout(function(){e.check_pay()},2e3);case 12:case"end":return t.stop()}},t,e)}))()},is_weixn:function(){return"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)},buyItem:function(){this.price=this.res.present_price},buyVIP:function(){this.$router.push({name:"buyVIP"})},getDetail:function(){var e=this;return n()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.id){t.next=4;break}return Object(u.a)({message:"该题目不存在"}),t.abrupt("return");case 4:return t.next=6,e.$http.get("test/question/no_paid/"+e.id);case 6:(a=(a=t.sent).data).bigPic="",a.smallPic="",1==a.image_list[1].type&&(a.bigPic=a.image_list[0].url),1==a.image_list[1].type&&(a.smallPic=a.image_list[0].url),0==a.image_list[0].type&&(a.bigPic=a.image_list[0].url),1==a.image_list[0].type&&(a.smallPic=a.image_list[0].url),e.res=a,e.price=e.res.present_price,e.finished=!0,console.log(e.res);case 18:case"end":return t.stop()}},t,e)}))()}},mounted:function(){this.getDetail()}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-tips"},[a("div",{staticClass:"back",on:{click:e.back}}),e._v(" "),a("div",{staticClass:"title"},[e._v(e._s(e.res.name))]),e._v(" "),a("div",{staticClass:"tips-bottom"},[a("div",{staticClass:"top-cover"}),e._v(" "),a("div",{staticClass:"des",staticStyle:{"line-height":"normal"},domProps:{innerHTML:e._s(e.res.content)}})]),e._v(" "),a("Dialog"),e._v(" "),a("van-popup",{attrs:{position:"bottom"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[a("div",{staticClass:"popup"},[a("span",{staticClass:"cha iconfont icon-cha",on:{click:function(t){e.show=!1}}}),e._v(" "),a("div",{staticClass:"pop-price",on:{click:e.pay_success}},[e._v("¥ "+e._s(e._f("cy")(e.price)))]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.isweixin,expression:"!isweixin"}],staticClass:"item",on:{click:e.ali_pay}},[a("span",{staticClass:"left"},[a("span",{staticClass:"zhifubao"}),e._v(" "),a("span",{staticClass:"name"},[e._v("支付宝")])]),e._v(" "),a("span",{staticClass:"arrow iconfont icon-arrowR"})]),e._v(" "),a("div",{staticClass:"item",on:{click:e.weixin_pay}},[a("span",{staticClass:"left"},[a("span",{staticClass:"weixin"}),e._v(" "),a("span",{staticClass:"name"},[e._v("微信")])]),e._v(" "),a("span",{staticClass:"arrow iconfont icon-arrowR"})])])]),e._v(" "),a("div",{staticClass:"hidden",domProps:{innerHTML:e._s(this.form)}}),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.finished,expression:"finished"}]},[a("div",{directives:[{name:"show",rawName:"v-show",value:1==e.res.is_vip_free||!(e.level>0),expression:"res.is_vip_free == 1 || !(level>0)"}]},[this.price>0?a("div",{staticClass:"pay-copy"}):e._e(),e._v(" "),this.price>0?a("div",{staticClass:"pay"},[a("div",{staticClass:"left"},[e._v("¥ "+e._s(e._f("cy")(e.price)))]),e._v(" "),a("div",{staticClass:"right",on:{click:function(t){e.show=!0}}},[e._v("去支付")])]):a("div",{staticClass:"pay-free"},[a("div",{staticClass:"go",on:{click:e.pay_free}},[e._v("GO")])])]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:0==e.res.is_vip_free&&e.level>0,expression:"res.is_vip_free == 0 && level>0"}],staticClass:"pay-free"},[a("div",{staticClass:"go",on:{click:e.vip_pay_free}},[e._v("GO")])])])],1)},staticRenderFns:[]};var l=a("VU/8")(p,d,!1,function(e){a("kShg"),a("p4BO")},"data-v-026f9b7d",null);t.default=l.exports},kShg:function(e,t){},p4BO:function(e,t){}});
//# sourceMappingURL=8.aa21ff888dd85c66509e.js.map